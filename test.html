<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APIæµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h1, h2 {
            color: #333;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .user-card {
            border: 1px solid #ddd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            background: #f9f9f9;
        }
        .user-card h3 {
            margin-top: 0;
            color: #007bff;
        }
        .form-group {
            margin: 10px 0;
        }
        label {
            display: inline-block;
            width: 80px;
            font-weight: bold;
        }
        input, select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 200px;
        }
        .error {
            color: red;
            font-weight: bold;
        }
        .success {
            color: green;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>ğŸš€ APIæµ‹è¯•é¡µé¢</h1>
    
    <div class="container">
        <h2>ğŸ“Š è·å–æ‰€æœ‰ç”¨æˆ·</h2>
        <button onclick="getAllUsers()">è·å–ç”¨æˆ·åˆ—è¡¨</button>
        <div id="usersList"></div>
    </div>

    <div class="container">
        <h2>ğŸ” è·å–å•ä¸ªç”¨æˆ·</h2>
        <div class="form-group">
            <label>ç”¨æˆ·ID:</label>
            <input type="text" id="userId" placeholder="è¾“å…¥ç”¨æˆ·ID" value="6ba7b810-9dad-11d1-80b4-00c04fd430c8">
            <button onclick="getUser()">è·å–ç”¨æˆ·</button>
        </div>
        <div id="singleUser"></div>
    </div>

    <div class="container">
        <h2>â• åˆ›å»ºæ–°ç”¨æˆ·</h2>
        <div class="form-group">
            <label>å§“å:</label>
            <input type="text" id="newName" placeholder="è¾“å…¥å§“å">
        </div>
        <div class="form-group">
            <label>å¹´é¾„:</label>
            <input type="number" id="newAge" placeholder="18-65" min="18" max="65">
        </div>
        <div class="form-group">
            <label>é‚®ç®±:</label>
            <input type="email" id="newEmail" placeholder="è¾“å…¥é‚®ç®±">
        </div>
        <div class="form-group">
            <label>è§’è‰²:</label>
            <select id="newRole">
                <option value="admin">ç®¡ç†å‘˜</option>
                <option value="editor">ç¼–è¾‘è€…</option>
                <option value="viewer">æŸ¥çœ‹è€…</option>
            </select>
        </div>
        <button onclick="createUser()">åˆ›å»ºç”¨æˆ·</button>
        <div id="createResult"></div>
    </div>

    <div class="container">
        <h2>âœï¸ æ›´æ–°ç”¨æˆ·</h2>
        <div class="form-group">
            <label>ç”¨æˆ·ID:</label>
            <input type="text" id="updateUserId" placeholder="è¾“å…¥ç”¨æˆ·ID" value="6ba7b810-9dad-11d1-80b4-00c04fd430c8">
        </div>
        <div class="form-group">
            <label>å§“å:</label>
            <input type="text" id="updateName" placeholder="è¾“å…¥æ–°å§“å">
        </div>
        <div class="form-group">
            <label>å¹´é¾„:</label>
            <input type="number" id="updateAge" placeholder="18-65" min="18" max="65">
        </div>
        <div class="form-group">
            <label>é‚®ç®±:</label>
            <input type="email" id="updateEmail" placeholder="è¾“å…¥æ–°é‚®ç®±">
        </div>
        <div class="form-group">
            <label>è§’è‰²:</label>
            <select id="updateRole">
                <option value="">ä¿æŒä¸å˜</option>
                <option value="admin">ç®¡ç†å‘˜</option>
                <option value="editor">ç¼–è¾‘è€…</option>
                <option value="viewer">æŸ¥çœ‹è€…</option>
            </select>
        </div>
        <button onclick="updateUser()">æ›´æ–°ç”¨æˆ·</button>
        <div id="updateResult"></div>
    </div>

    <div class="container">
        <h2>ğŸ—‘ï¸ åˆ é™¤ç”¨æˆ·</h2>
        <div class="form-group">
            <label>ç”¨æˆ·ID:</label>
            <input type="text" id="deleteUserId" placeholder="è¾“å…¥ç”¨æˆ·ID">
            <button onclick="deleteUser()">åˆ é™¤ç”¨æˆ·</button>
        </div>
        <div id="deleteResult"></div>
    </div>

    <div class="container">
        <h2>ğŸ” æŒ‰è§’è‰²ç­›é€‰</h2>
        <select id="filterRole" onchange="filterByRole()">
            <option value="">é€‰æ‹©è§’è‰²</option>
            <option value="admin">ç®¡ç†å‘˜</option>
            <option value="editor">ç¼–è¾‘è€…</option>
            <option value="viewer">æŸ¥çœ‹è€…</option>
        </select>
        <div id="filteredUsers"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3000';

        async function getAllUsers() {
            try {
                const response = await fetch(`${API_BASE}/api/users`);
                const result = await response.json();
                
                if (result.success) {
                    const usersHtml = result.data.map(user => `
                        <div class="user-card">
                            <h3>${user.name}</h3>
                            <p><strong>ID:</strong> ${user.id}</p>
                            <p><strong>å¹´é¾„:</strong> ${user.age}</p>
                            <p><strong>é‚®ç®±:</strong> ${user.email}</p>
                            <p><strong>è§’è‰²:</strong> ${user.role}</p>
                        </div>
                    `).join('');
                    document.getElementById('usersList').innerHTML = usersHtml;
                } else {
                    document.getElementById('usersList').innerHTML = `<p class="error">${result.message}</p>`;
                }
            } catch (error) {
                document.getElementById('usersList').innerHTML = `<p class="error">è¯·æ±‚å¤±è´¥: ${error.message}</p>`;
            }
        }

        async function getUser() {
            const userId = document.getElementById('userId').value;
            if (!userId) {
                alert('è¯·è¾“å…¥ç”¨æˆ·ID');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/users/${userId}`);
                const result = await response.json();
                
                if (result.success) {
                    const user = result.data;
                    document.getElementById('singleUser').innerHTML = `
                        <div class="user-card">
                            <h3>${user.name}</h3>
                            <p><strong>ID:</strong> ${user.id}</p>
                            <p><strong>å¹´é¾„:</strong> ${user.age}</p>
                            <p><strong>é‚®ç®±:</strong> ${user.email}</p>
                            <p><strong>è§’è‰²:</strong> ${user.role}</p>
                        </div>
                    `;
                } else {
                    document.getElementById('singleUser').innerHTML = `<p class="error">${result.message}</p>`;
                }
            } catch (error) {
                document.getElementById('singleUser').innerHTML = `<p class="error">è¯·æ±‚å¤±è´¥: ${error.message}</p>`;
            }
        }

        async function createUser() {
            const name = document.getElementById('newName').value;
            const age = parseInt(document.getElementById('newAge').value);
            const email = document.getElementById('newEmail').value;
            const role = document.getElementById('newRole').value;

            if (!name || !age || !email || !role) {
                alert('è¯·å¡«å†™æ‰€æœ‰å­—æ®µ');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/users`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json; charset=utf-8'
                    },
                    body: JSON.stringify({ name, age, email, role })
                });

                const result = await response.json();
                
                if (result.success) {
                    document.getElementById('createResult').innerHTML = `<p class="success">${result.message}</p>`;
                    // æ¸…ç©ºè¡¨å•
                    document.getElementById('newName').value = '';
                    document.getElementById('newAge').value = '';
                    document.getElementById('newEmail').value = '';
                    document.getElementById('newRole').value = 'admin';
                } else {
                    document.getElementById('createResult').innerHTML = `<p class="error">${result.message}</p>`;
                }
            } catch (error) {
                document.getElementById('createResult').innerHTML = `<p class="error">è¯·æ±‚å¤±è´¥: ${error.message}</p>`;
            }
        }

        async function updateUser() {
            const userId = document.getElementById('updateUserId').value;
            const name = document.getElementById('updateName').value;
            const age = document.getElementById('updateAge').value;
            const email = document.getElementById('updateEmail').value;
            const role = document.getElementById('updateRole').value;

            if (!userId) {
                alert('è¯·è¾“å…¥ç”¨æˆ·ID');
                return;
            }

            const updateData = {};
            if (name) updateData.name = name;
            if (age) updateData.age = parseInt(age);
            if (email) updateData.email = email;
            if (role) updateData.role = role;

            if (Object.keys(updateData).length === 0) {
                alert('è¯·è‡³å°‘å¡«å†™ä¸€ä¸ªè¦æ›´æ–°çš„å­—æ®µ');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/users/${userId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json; charset=utf-8'
                    },
                    body: JSON.stringify(updateData)
                });

                const result = await response.json();
                
                if (result.success) {
                    document.getElementById('updateResult').innerHTML = `<p class="success">${result.message}</p>`;
                    // æ¸…ç©ºè¡¨å•
                    document.getElementById('updateName').value = '';
                    document.getElementById('updateAge').value = '';
                    document.getElementById('updateEmail').value = '';
                    document.getElementById('updateRole').value = '';
                } else {
                    document.getElementById('updateResult').innerHTML = `<p class="error">${result.message}</p>`;
                }
            } catch (error) {
                document.getElementById('updateResult').innerHTML = `<p class="error">è¯·æ±‚å¤±è´¥: ${error.message}</p>`;
            }
        }

        async function deleteUser() {
            const userId = document.getElementById('deleteUserId').value;
            if (!userId) {
                alert('è¯·è¾“å…¥ç”¨æˆ·ID');
                return;
            }

            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªç”¨æˆ·å—ï¼Ÿ')) {
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/users/${userId}`, {
                    method: 'DELETE'
                });

                const result = await response.json();
                
                if (result.success) {
                    document.getElementById('deleteResult').innerHTML = `<p class="success">${result.message}</p>`;
                    document.getElementById('deleteUserId').value = '';
                } else {
                    document.getElementById('deleteResult').innerHTML = `<p class="error">${result.message}</p>`;
                }
            } catch (error) {
                document.getElementById('deleteResult').innerHTML = `<p class="error">è¯·æ±‚å¤±è´¥: ${error.message}</p>`;
            }
        }

        async function filterByRole() {
            const role = document.getElementById('filterRole').value;
            if (!role) {
                document.getElementById('filteredUsers').innerHTML = '';
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/users/role/${role}`);
                const result = await response.json();
                
                if (result.success) {
                    const usersHtml = result.data.map(user => `
                        <div class="user-card">
                            <h3>${user.name}</h3>
                            <p><strong>ID:</strong> ${user.id}</p>
                            <p><strong>å¹´é¾„:</strong> ${user.age}</p>
                            <p><strong>é‚®ç®±:</strong> ${user.email}</p>
                            <p><strong>è§’è‰²:</strong> ${user.role}</p>
                        </div>
                    `).join('');
                    document.getElementById('filteredUsers').innerHTML = usersHtml;
                } else {
                    document.getElementById('filteredUsers').innerHTML = `<p class="error">${result.message}</p>`;
                }
            } catch (error) {
                document.getElementById('filteredUsers').innerHTML = `<p class="error">è¯·æ±‚å¤±è´¥: ${error.message}</p>`;
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è·å–ç”¨æˆ·åˆ—è¡¨
        window.onload = function() {
            getAllUsers();
        };
    </script>
</body>
</html>
